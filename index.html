<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Oyun Alanƒ± - Discord Gaming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <style>
    :root {
      --bg-primary: #36393f;
      --bg-secondary: #2f3136;
      --bg-tertiary: #202225;
      --bg-chat: #40444b;
      --text-primary: #dcddde;
      --text-secondary: #b9bbbe;
      --text-muted: #72767d;
      --accent: #5865f2;
      --accent-hover: #4752c4;
      --success: #3ba55d;
      --danger: #ed4245;
      --warning: #faa81a;
    }

    [data-theme="light"] {
      --bg-primary: #ffffff;
      --bg-secondary: #f2f3f5;
      --bg-tertiary: #e3e5e8;
      --bg-chat: #ebedef;
      --text-primary: #2e3338;
      --text-secondary: #4e5058;
      --text-muted: #72767d;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: background 0.3s, color 0.3s;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    main { flex: 1 0 auto; }

    /* NAVBAR */
    .navbar {
      background: var(--bg-secondary) !important;
      border-bottom: 1px solid var(--bg-tertiary);
      padding: 0.75rem 0;
      transition: background 0.3s;
    }

    .brand-logo {
      height: 40px;
      width: auto;
      object-fit: contain;
      filter: drop-shadow(0 0 10px rgba(88, 101, 242, 0.5));
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--text-primary) !important;
      font-weight: 700;
      font-size: 1.25rem;
    }

    .nav-link {
      color: var(--text-secondary) !important;
      font-weight: 500;
      padding: 0.5rem 1rem !important;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .nav-link:hover {
      background: var(--bg-chat);
      color: var(--text-primary) !important;
    }

    .nav-link.active {
      background: var(--accent);
      color: white !important;
    }

    /* THEME TOGGLE */
    .theme-toggle {
      background: var(--bg-chat);
      border: none;
      color: var(--text-primary);
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      margin-left: 1rem;
    }

    .theme-toggle:hover {
      background: var(--accent);
      color: white;
    }

    /* USER BADGE */
    .user-badge {
      background: var(--bg-chat);
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-left: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .user-badge:hover {
      background: var(--accent);
      transform: scale(1.05);
    }

    .user-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 14px;
    }

    .user-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .login-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.5rem 1.5rem;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-left: 1rem;
    }

    .login-btn:hover {
      background: var(--accent-hover);
    }

    /* SEARCH BAR */
    .search-container {
      position: relative;
      max-width: 500px;
      margin: 2rem auto;
    }

    .search-input {
      width: 100%;
      background: var(--bg-secondary);
      border: 2px solid transparent;
      color: var(--text-primary);
      padding: 0.75rem 1rem 0.75rem 3rem;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--bg-chat);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }

    /* FILTERS */
    .filters-container {
      background: var(--bg-secondary);
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
    }

    .filter-btn {
      background: var(--bg-chat);
      border: 2px solid transparent;
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
      margin: 0.25rem;
    }

    .filter-btn:hover {
      border-color: var(--accent);
      color: var(--text-primary);
    }

    .filter-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    /* SIDEBAR */
    .sidebar {
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 10px rgba(0,0,0,.2);
      position: sticky;
      top: 20px;
    }

    .sidebar h5 {
      color: var(--text-primary);
      font-weight: 700;
      margin-bottom: 1rem;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
    }

    .sidebar ul li {
      margin: 0.5rem 0;
    }

    .sidebar ul li a {
      color: var(--text-secondary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .sidebar ul li a:hover {
      background: var(--bg-chat);
      color: var(--text-primary);
    }

    .sidebar ul li a.active {
      background: var(--accent);
      color: white;
    }

    .category-icon {
      width: 20px;
      text-align: center;
    }

    /* GAME CARDS */
    .game-card {
      background: var(--bg-secondary);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,.3);
      transition: all 0.3s ease;
      height: 100%;
      display: flex;
      flex-direction: column;
      position: relative;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .game-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 24px rgba(88, 101, 242, 0.3);
    }

    .game-thumb-container {
      position: relative;
      overflow: hidden;
    }

    .game-thumb {
      aspect-ratio: 16/9;
      object-fit: cover;
      width: 100%;
      transition: transform 0.3s;
    }

    .game-card:hover .game-thumb {
      transform: scale(1.1);
    }

    .game-badge {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(88, 101, 242, 0.9);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      backdrop-filter: blur(4px);
    }

    .favorite-btn {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      background: rgba(0, 0, 0, 0.6);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .favorite-btn:hover {
      background: rgba(237, 66, 69, 0.9);
      transform: scale(1.1);
    }

    .favorite-btn.active {
      background: rgba(237, 66, 69, 0.9);
    }

    .card-body {
      padding: 1.25rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .game-title {
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
      font-size: 1.1rem;
    }

    .game-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 1rem;
      flex: 1;
    }

    .game-stats {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .rating-stars {
      color: #faa81a;
    }

    .play-btn {
      background: var(--accent);
      border: none;
      color: white;
      padding: 0.75rem;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .play-btn:hover {
      background: var(--accent-hover);
      transform: scale(1.02);
    }

    .info-btn {
      background: transparent;
      border: 2px solid var(--bg-chat);
      color: var(--text-secondary);
      padding: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 0.5rem;
    }

    .info-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* GAME MODAL */
    .modal-content {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--bg-tertiary);
    }

    .modal-header {
      border-bottom: 1px solid var(--bg-tertiary);
    }

    .modal-body {
      position: relative;
      padding: 0;
    }

    #gameFrame {
      width: 100%;
      height: calc(100vh - 60px);
      border: 0;
    }

    .floating-close {
      position: absolute;
      right: 12px;
      bottom: 12px;
      z-index: 10;
      border: 0;
      border-radius: 999px;
      padding: 10px 16px;
      background: rgba(237, 66, 69, 0.9);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      backdrop-filter: blur(4px);
      transition: all 0.2s;
    }

    .floating-close:hover {
      background: var(--danger);
      transform: scale(1.05);
    }

    /* GAME INFO MODAL */
    .game-info-modal .modal-dialog {
      max-width: 800px;
    }

    .game-info-header {
      position: relative;
      height: 300px;
      overflow: hidden;
    }

    .game-info-header img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .game-info-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 2rem;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
    }

    .game-info-title {
      font-size: 2rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
    }

    .game-info-rating {
      display: flex;
      align-items: center;
      gap: 1rem;
      color: white;
    }

    .tabs-container {
      border-bottom: 1px solid var(--bg-tertiary);
    }

    .tab-btn {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      padding: 1rem 1.5rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      color: var(--text-primary);
    }

    .tab-btn.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    .tab-content {
      padding: 1.5rem;
    }

    .tab-pane {
      display: none;
    }

    .tab-pane.active {
      display: block;
    }

    /* REVIEWS */
    .review-form {
      background: var(--bg-chat);
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
    }

    .star-rating {
      display: flex;
      gap: 0.5rem;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .star {
      color: #4e5058;
      cursor: pointer;
      transition: all 0.2s;
    }

    .star:hover,
    .star.active {
      color: #faa81a;
    }

    .review-textarea {
      width: 100%;
      background: var(--bg-secondary);
      border: 2px solid transparent;
      color: var(--text-primary);
      padding: 0.75rem;
      border-radius: 6px;
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    .review-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    .review-item {
      background: var(--bg-chat);
      padding: 1.25rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .review-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .review-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
    }

    .review-user-info {
      flex: 1;
    }

    .review-user-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .review-date {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .review-rating {
      color: #faa81a;
      font-size: 0.9rem;
    }

    .review-text {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 0.75rem;
    }

    .review-actions {
      display: flex;
      gap: 1rem;
    }

    .review-action-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .review-action-btn:hover {
      color: var(--accent);
    }

    .review-action-btn.liked {
      color: var(--accent);
    }

    .review-action-btn.delete:hover {
      color: var(--danger);
    }

    /* FOOTER */
    footer {
      margin-top: auto;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      padding: 2rem 0;
      border-top: 1px solid var(--bg-secondary);
    }

    .footer-links {
      display: flex;
      gap: 2rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      transition: color 0.2s;
    }

    .footer-links a:hover {
      color: var(--accent);
    }

    /* LOADING SKELETON */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-chat) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 8px;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .skeleton-card {
      height: 350px;
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-muted);
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .sidebar {
        margin-bottom: 2rem;
      }

      .filters-container {
        overflow-x: auto;
        white-space: nowrap;
      }

      .game-info-title {
        font-size: 1.5rem;
      }

      .search-container {
        margin: 1rem auto;
      }
    }

    /* LOGIN SCREEN (ARTIK OTOMATƒ∞K A√áILMIYOR - SADECE MANUEL ƒ∞STERSEN KULLAN) */
    #loginScreen {
      position: fixed;
      inset: 0;
      background: var(--bg-tertiary);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    #loginScreen.active {
      display: flex;
    }

    .login-container {
      background: var(--bg-secondary);
      padding: 3rem;
      border-radius: 12px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }

    .login-container h2 {
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    .login-container p {
      color: var(--text-secondary);
      margin-bottom: 2rem;
    }

    #googleLoginBtn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    #googleLoginBtn:hover {
      background: var(--accent-hover);
    }

    /* SETUP WARNING */
    .setup-warning {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(237, 66, 69, 0.95);
      color: white;
      padding: 1rem 2rem;
      border-radius: 8px;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: slideDown 0.3s ease;
      max-width: 90%;
      text-align: center;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translate(-50%, -20px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }
  </style>
</head>
<body>
  <!-- LOGIN SCREEN (isteƒüe baƒülƒ±, artƒ±k otomatik a√ßƒ±lmƒ±yor) -->
  <div id="loginScreen">
    <div class="login-container">
      <h2>üéÆ Oyun Alanƒ±na Ho≈ü Geldiniz</h2>
      <p>Devam etmek i√ßin giri≈ü yapƒ±n</p>
      <button id="googleLoginBtn">
        <i class="fab fa-google"></i>
        Google ile Giri≈ü Yap
      </button>
    </div>
  </div>

  <!-- HEADER -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="#">
        <img src="logo.png" alt="Logo" class="brand-logo" onerror="this.style.display='none'">
        <span>Oyun Alanƒ±</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="navbarMenu" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="#">Ana Sayfa</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="favoritesLink">Favoriler</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Kategoriler</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Hakkƒ±mƒ±zda</a></li>
        </ul>

        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>

        <!-- Giri≈ü yokken g√∂ster -->
        <button id="loginBtn" class="login-btn" style="display:none;">
          Giri≈ü Yap
        </button>

        <!-- Giri≈ü varken g√∂ster -->
        <div id="userBadge" class="user-badge" style="display:none;" title="Profil sayfasƒ±na git">
          <div class="user-avatar" id="userAvatar">U</div>
          <span class="user-name" id="userName">Kullanƒ±cƒ±</span>
        </div>

        <button id="logoutBtn" class="login-btn" style="display:none;">
          √áƒ±kƒ±≈ü Yap
        </button>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="container py-4">
    <!-- Search -->
    <div class="search-container">
      <i class="fas fa-search search-icon"></i>
      <input type="text" class="search-input" id="searchInput" placeholder="Oyun ara...">
    </div>

    <!-- Filters -->
    <div class="filters-container">
      <div class="d-flex align-items-center justify-content-between flex-wrap">
        <div>
          <button class="filter-btn active" data-filter="all">
            <i class="fas fa-gamepad"></i> T√ºm√º
          </button>
          <button class="filter-btn" data-filter="Aksiyon">
            <i class="fas fa-fist-raised"></i> Aksiyon
          </button>
          <button class="filter-btn" data-filter="Bulmaca">
            <i class="fas fa-puzzle-piece"></i> Bulmaca
          </button>
          <button class="filter-btn" data-filter="Macera">
            <i class="fas fa-map-marked-alt"></i> Macera
          </button>
          <button class="filter-btn" data-filter="Eƒülence">
            <i class="fas fa-laugh"></i> Eƒülence
          </button>
        </div>
        <div>
          <select class="filter-btn" id="sortSelect">
            <option value="popular">En Pop√ºler</option>
            <option value="rating">En Y√ºksek Puan</option>
            <option value="newest">En Yeni</option>
          </select>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- SIDEBAR -->
      <aside class="col-12 col-md-3">
        <div class="sidebar">
          <h5>Kategoriler</h5>
          <ul>
            <li>
              <a href="#" class="active" data-category="all">
                <span class="category-icon"><i class="fas fa-gamepad"></i></span>
                T√ºm Oyunlar
              </a>
            </li>
            <li>
              <a href="#" data-category="Aksiyon">
                <span class="category-icon"><i class="fas fa-fist-raised"></i></span>
                Aksiyon
              </a>
            </li>
            <li>
              <a href="#" data-category="Bulmaca">
                <span class="category-icon"><i class="fas fa-puzzle-piece"></i></span>
                Bulmaca
              </a>
            </li>
            <li>
              <a href="#" data-category="Macera">
                <span class="category-icon"><i class="fas fa-map-marked-alt"></i></span>
                Macera
              </a>
            </li>
            <li>
              <a href="#" data-category="Eƒülence">
                <span class="category-icon"><i class="fas fa-laugh"></i></span>
                Eƒülence
              </a>
            </li>
          </ul>

          <h5 style="margin-top: 2rem;">ƒ∞statistikler</h5>
          <ul style="list-style: none; padding: 0;">
            <li style="color: var(--text-secondary); margin: 0.5rem 0;">
              <i class="fas fa-fire" style="color: var(--danger);"></i>
              <span id="totalGames">0</span> Oyun
            </li>
            <li style="color: var(--text-secondary); margin: 0.5rem 0;">
              <i class="fas fa-star" style="color: var(--warning);"></i>
              <span id="totalReviews">0</span> Yorum
            </li>
          </ul>
        </div>
      </aside>

      <!-- GAMES GRID -->
      <section class="col-12 col-md-9">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h1 class="h4 mb-0">
            <i class="fas fa-fire" style="color: var(--danger);"></i>
            Oyunlar
          </h1>
          <span id="gameCount" style="color: var(--text-muted); font-size: 0.9rem;">
            Y√ºkleniyor...
          </span>
        </div>

        <div class="row g-3" id="gamesContainer">
          <!-- Skeleton Loading -->
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="skeleton skeleton-card"></div>
          </div>
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="skeleton skeleton-card"></div>
          </div>
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="skeleton skeleton-card"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="container">
      <div class="footer-links">
        <a href="#">Hakkƒ±mƒ±zda</a>
        <a href="#">Gizlilik Politikasƒ±</a>
        <a href="#">Kullanƒ±m ≈ûartlarƒ±</a>
        <a href="#">ƒ∞leti≈üim</a>
        <a href="#">Discord</a>
      </div>
      <div class="text-center">
        <p class="mb-0">&copy; 2025 Oyun Alanƒ±. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
      </div>
    </div>
  </footer>

  <!-- GAME PLAY MODAL -->
  <div class="modal fade" id="gameModal" tabindex="-1">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Oyun</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <button type="button" class="floating-close" id="floatingCloseBtn">
            <i class="fas fa-times"></i> Kapat
          </button>
          <iframe id="gameFrame" src="" allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </div>

  <!-- GAME INFO MODAL -->
  <div class="modal fade game-info-modal" id="gameInfoModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="game-info-header" id="gameInfoHeader">
          <img src="" alt="Game" id="gameInfoImage">
          <div class="game-info-overlay">
            <h2 class="game-info-title" id="gameInfoTitle">Oyun Adƒ±</h2>
            <div class="game-info-rating">
              <span class="rating-stars" id="gameInfoStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
              <span id="gameInfoRating">4.5</span>
              <span>‚Ä¢</span>
              <span id="gameInfoReviewCount">0 yorum</span>
            </div>
          </div>
        </div>

        <div class="tabs-container">
          <button class="tab-btn active" data-tab="about">Hakkƒ±nda</button>
          <button class="tab-btn" data-tab="reviews">Yorumlar</button>
        </div>

        <div class="modal-body">
          <!-- About Tab -->
          <div class="tab-pane active" id="aboutTab">
            <div class="tab-content">
              <p id="gameInfoDescription" style="color: var(--text-secondary); line-height: 1.6;">
                Oyun a√ßƒ±klamasƒ± buraya gelecek...
              </p>
              <div style="margin-top: 1.5rem;">
                <strong style="color: var(--text-primary);">Kategori:</strong>
                <span id="gameInfoCategory" style="color: var(--text-secondary);"></span>
              </div>
              <button class="play-btn" style="margin-top: 1.5rem; width: 100%;" id="playFromInfo">
                <i class="fas fa-play"></i> ≈ûimdi Oyna
              </button>
            </div>
          </div>

          <!-- Reviews Tab -->
          <div class="tab-pane" id="reviewsTab">
            <div class="tab-content">
              <!-- Review Form -->
              <div class="review-form" id="reviewForm">
                <h5 style="margin-bottom: 1rem;">Yorumunuzu Payla≈üƒ±n</h5>
                <div class="star-rating" id="starRating">
                  <i class="fas fa-star star" data-rating="1"></i>
                  <i class="fas fa-star star" data-rating="2"></i>
                  <i class="fas fa-star star" data-rating="3"></i>
                  <i class="fas fa-star star" data-rating="4"></i>
                  <i class="fas fa-star star" data-rating="5"></i>
                </div>
                <textarea
                  class="review-textarea"
                  id="reviewText"
                  placeholder="Oyun hakkƒ±nda d√º≈ü√ºncelerinizi yazƒ±n..."
                  maxlength="500"
                ></textarea>
                <button class="play-btn" id="submitReview" style="margin-top: 1rem;">
                  <i class="fas fa-paper-plane"></i> G√∂nder
                </button>
              </div>

              <!-- Reviews List -->
              <div id="reviewsList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      doc,
      setDoc,
      getDoc,
      getDocs,
      query,
      orderBy,
      where,
      onSnapshot,
      updateDoc,
      deleteDoc,
      serverTimestamp,
      increment
    } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDI0lC7bhuvXu6MHJYTmX9VETyU5fglZS4",
      authDomain: "deneme-58622.firebaseapp.com",
      projectId: "deneme-58622",
      storageBucket: "deneme-58622.firebasestorage.app",
      messagingSenderId: "842705198192",
      appId: "1:842705198192:web:b4e9973bda2e391a93a8b5"
    };

    const gamesData = [
      {
        id: "snake",
        title: "Tƒ±kla & Yakala",
        description: "Klasik yƒ±lan oyunu. Yemi topla ve b√ºy√º!",
        category: "Aksiyon",
        thumbnail: "https://i.ytimg.com/vi/xq4kgfSl69k/hq720.jpg",
        url: "snake.html",
        badge: "Pop√ºler"
      },
      {
        id: "snake2",
        title: "Tƒ±kla & Yakala",
        description: "Klasik yƒ±lan oyunu. Yemi topla ve b√ºy√º!",
        category: "Aksiyon",
        thumbnail: "https://i.ytimg.com/vi/xq4kgfSl69k/hq720.jpg",
        url: "snake.html",
        badge: "Pop√ºler"
      }
    ];

    // Check if Firebase is configured
    function isFirebaseConfigured() {
      return !firebaseConfig.apiKey.includes('YOUR_');
    }

    function showSetupWarning() {
      const warning = document.createElement('div');
      warning.className = 'setup-warning';
      warning.innerHTML = `
        <i class="fas fa-exclamation-triangle"></i>
        <strong>Firebase Yapƒ±landƒ±rmasƒ± Gerekli!</strong>
        <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">
          L√ºtfen kodda "firebaseConfig" b√∂l√ºm√ºn√º kendi Firebase bilgilerinizle g√ºncelleyin.
        </p>
      `;
      document.body.appendChild(warning);
    }

    // Initialize Firebase
    let app, auth, db, provider;

    try {
      if (!isFirebaseConfigured()) {
        showSetupWarning();
        console.error('‚ö†Ô∏è Firebase yapƒ±landƒ±rmasƒ± gerekli! L√ºtfen firebaseConfig deƒüerlerini g√ºncelleyin.');
      }

      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);
      provider = new GoogleAuthProvider();

      console.log('‚úÖ Firebase ba≈üarƒ±yla ba≈ülatƒ±ldƒ±!');
    } catch (error) {
      console.error('‚ùå Firebase ba≈ülatma hatasƒ±:', error);
      showSetupWarning();
    }

    // Global variables
    let currentUser = null;
    let currentTheme = localStorage.getItem('theme') || 'dark';
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    let allGames = [];
    let currentGameId = null;
    let selectedRating = 0;

    // DOM Elements
    const loginScreen = document.getElementById('loginScreen');
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userBadge = document.getElementById('userBadge');
    const userAvatar = document.getElementById('userAvatar');
    const userName = document.getElementById('userName');
    const themeToggle = document.getElementById('themeToggle');
    const searchInput = document.getElementById('searchInput');
    const gamesContainer = document.getElementById('gamesContainer');
    const gameModal = new bootstrap.Modal(document.getElementById('gameModal'));
    const gameInfoModal = new bootstrap.Modal(document.getElementById('gameInfoModal'));
    const gameFrame = document.getElementById('gameFrame');

    // Theme init
    setTheme(currentTheme);

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // ‚úÖ LOGIN: SADECE PROFƒ∞LE Gƒ∞Dƒ∞NCE / LOGIN BUTONUNA BASINCA
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function ensureLogin() {
      if (!auth) return null;
      if (currentUser) return currentUser;

      try {
        const result = await signInWithPopup(auth, provider);
        return result?.user || null;
      } catch (error) {
        console.error('Giri≈ü hatasƒ±:', error);
        alert('Giri≈ü yapƒ±lamadƒ±!');
        return null;
      }
    }

    // Navbar "Giri≈ü Yap"
    loginBtn.addEventListener('click', async () => {
      await ensureLogin();
    });

    // (Opsiyonel) login ekranƒ±ndaki buton (istersen hi√ß kullanma)
    googleLoginBtn.addEventListener('click', async () => {
      await ensureLogin();
      loginScreen.classList.remove('active');
    });

    // Profil rozetine tƒ±klayƒ±nca:
    userBadge.addEventListener('click', async () => {
      // Zaten giri≈üliysen direkt profile
      if (currentUser) {
        window.location.href = 'profile2.html';
        return;
      }

      // Giri≈üli deƒüilsen popup a√ß, sonra profile
      const u = await ensureLogin();
      if (u) window.location.href = 'profile2.html';
    });

    // Logout
    logoutBtn.addEventListener('click', async () => {
      if (!auth) return;
      if (confirm('√áƒ±kƒ±≈ü yapmak istediƒüinize emin misiniz?')) {
        await signOut(auth);
      }
    });

    // Auth state listener (Sayfa a√ßƒ±lƒ±≈üƒ±nda login zorlamaz!)
    if (auth) {
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          currentUser = {
            id: user.uid,
            name: user.displayName || 'Kullanƒ±cƒ±',
            email: user.email,
            avatar: user.photoURL
          };

          // Kullanƒ±cƒ± kaydƒ± g√ºncelle
          if (db) {
            await setDoc(doc(db, "users", user.uid), {
              uid: user.uid,
              name: currentUser.name,
              email: currentUser.email,
              avatar: currentUser.avatar,
              lastLogin: serverTimestamp()
            }, { merge: true });
          }

          // UI
          loginBtn.style.display = 'none';
          userBadge.style.display = 'flex';
          logoutBtn.style.display = 'block';
          userAvatar.textContent = currentUser.name[0].toUpperCase();
          userName.textContent = currentUser.name;

          // Oyunlarƒ± Firestore'a senkronize etmek yazma gerektirir ‚Üí giri≈üliyken √ßalƒ±≈ütƒ±r
          await initializeGamesInFirestore();

          // Oyunlarƒ± y√ºkle
          loadGames();
        } else {
          currentUser = null;

          // UI
          loginBtn.style.display = 'block';
          userBadge.style.display = 'none';
          logoutBtn.style.display = 'none';

          // Ziyaret√ßi modunda SADECE oku:
          loadGames();
        }
      });
    } else {
      // Firebase yoksa bile aray√ºz bo≈ü kalmasƒ±n
      loginBtn.style.display = 'none';
      userBadge.style.display = 'none';
      logoutBtn.style.display = 'none';
    }

    // Theme
    themeToggle.addEventListener('click', () => {
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    });

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      currentTheme = theme;
      localStorage.setItem('theme', theme);

      const icon = themeToggle.querySelector('i');
      icon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Firestore oyun senkronizasyonu (yazma gerektirir)
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function initializeGamesInFirestore() {
      if (!db) return;

      try {
        console.log('üéÆ Oyun veritabanƒ± senkronize ediliyor...');

        const existingGamesSnapshot = await getDocs(collection(db, 'games'));
        const existingGameIds = new Set();
        existingGamesSnapshot.forEach(d => existingGameIds.add(d.id));

        for (const game of gamesData) {
          const gameRef = doc(db, 'games', game.id);
          const gameDoc = await getDoc(gameRef);

          if (gameDoc.exists()) {
            await updateDoc(gameRef, {
              title: game.title,
              description: game.description,
              category: game.category,
              thumbnail: game.thumbnail,
              url: game.url,
              badge: game.badge || null,
              lastUpdated: serverTimestamp()
            });
          } else {
            await setDoc(gameRef, {
              ...game,
              averageRating: 0,
              totalReviews: 0,
              playCount: 0,
              createdAt: serverTimestamp(),
              lastUpdated: serverTimestamp()
            });
          }

          existingGameIds.delete(game.id);
        }

        // ƒ∞stersen burada silme i≈üini kaldƒ±rabilirsin (ziyaret√ßi modunda zaten √ßalƒ±≈ümƒ±yor)
        for (const gameId of existingGameIds) {
          try {
            const reviewsRef = collection(db, 'games', gameId, 'reviews');
            const reviewsSnapshot = await getDocs(reviewsRef);
            for (const reviewDoc of reviewsSnapshot.docs) {
              await deleteDoc(reviewDoc.ref);
            }
            await deleteDoc(doc(db, 'games', gameId));
          } catch (e) {
            console.error('Silme hatasƒ±:', gameId, e);
          }
        }

        console.log('‚úÖ Senkronizasyon tamamlandƒ±!');
      } catch (error) {
        console.error('‚ùå Oyun senkronizasyon hatasƒ±:', error);
      }
    }

    // Load games (okuma)
    async function loadGames() {
      if (!db) {
        gamesContainer.innerHTML = `
          <div class="col-12">
            <div class="empty-state">
              <i class="fas fa-exclamation-triangle"></i>
              <h3>Firebase Yapƒ±landƒ±rmasƒ± Gerekli</h3>
              <p>L√ºtfen kodda Firebase config bilgilerini g√ºncelleyin</p>
            </div>
          </div>
        `;
        return;
      }

      const gamesRef = collection(db, 'games');

      onSnapshot(gamesRef, (snapshot) => {
        allGames = [];
        snapshot.forEach((d) => {
          allGames.push({ id: d.id, ...d.data() });
        });

        renderGames(allGames);
        updateStats();
      }, (error) => {
        console.error('Oyunlar y√ºklenirken hata:', error);
      });
    }

    // Render games
    function renderGames(games) {
      gamesContainer.innerHTML = '';

      if (games.length === 0) {
        gamesContainer.innerHTML = `
          <div class="col-12">
            <div class="empty-state">
              <i class="fas fa-gamepad"></i>
              <h3>Oyun bulunamadƒ±</h3>
              <p>Arama kriterlerinizi deƒüi≈ütirmeyi deneyin</p>
            </div>
          </div>
        `;
        return;
      }

      games.forEach((game, index) => {
        const isFavorite = favorites.includes(game.id);
        const stars = renderStars(game.averageRating || 0);

        const card = document.createElement('div');
        card.className = 'col-12 col-sm-6 col-lg-4';
        card.style.animationDelay = `${index * 0.1}s`;

        card.innerHTML = `
          <div class="game-card">
            <div class="game-thumb-container">
              <img src="${game.thumbnail}" class="game-thumb" alt="${game.title}">
              ${game.badge ? `<div class="game-badge">${game.badge}</div>` : ''}
              <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-game-id="${game.id}">
                <i class="fas fa-heart"></i>
              </button>
            </div>
            <div class="card-body">
              <h5 class="game-title">${game.title}</h5>
              <p class="game-description">${game.description}</p>
              <div class="game-stats">
                <div class="stat-item">
                  <span class="rating-stars">${stars}</span>
                  <span>${(game.averageRating || 0).toFixed(1)}</span>
                </div>
                <div class="stat-item">
                  <i class="fas fa-comment"></i>
                  <span>${game.totalReviews || 0}</span>
                </div>
                <div class="stat-item">
                  <i class="fas fa-play-circle"></i>
                  <span>${game.playCount || 0}</span>
                </div>
              </div>
              <button class="play-btn" data-game-id="${game.id}" data-game-url="${game.url}">
                <i class="fas fa-play"></i> Oyna
              </button>
              <button class="info-btn" data-game-id="${game.id}">
                <i class="fas fa-info-circle"></i> Detaylar
              </button>
            </div>
          </div>
        `;

        gamesContainer.appendChild(card);
      });

      document.getElementById('gameCount').textContent = `${games.length} oyun g√∂steriliyor`;

      // Play
      document.querySelectorAll('.play-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const gameId = e.currentTarget.getAttribute('data-game-id');
          const gameUrl = e.currentTarget.getAttribute('data-game-url');

          // PlayCount yazma: giri≈ü yoksa atla
          if (db && currentUser) {
            await updateDoc(doc(db, 'games', gameId), { playCount: increment(1) });
          }

          gameFrame.src = gameUrl;
          gameModal.show();
        });
      });

      // Info
      document.querySelectorAll('.info-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const gameId = e.currentTarget.getAttribute('data-game-id');
          showGameInfo(gameId);
        });
      });

      // Favorite (localStorage, login gerekmez)
      document.querySelectorAll('.favorite-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const gameId = e.currentTarget.getAttribute('data-game-id');
          toggleFavorite(gameId);
        });
      });
    }

    function renderStars(rating) {
      const fullStars = Math.floor(rating);
      const halfStar = rating % 1 >= 0.5;
      let stars = '';

      for (let i = 0; i < fullStars; i++) stars += '‚òÖ';
      if (halfStar) stars += '¬Ω';

      const emptyStars = 5 - Math.ceil(rating);
      for (let i = 0; i < emptyStars; i++) stars += '‚òÜ';

      return stars;
    }

    function toggleFavorite(gameId) {
      const index = favorites.indexOf(gameId);
      if (index > -1) favorites.splice(index, 1);
      else favorites.push(gameId);

      localStorage.setItem('favorites', JSON.stringify(favorites));
      renderGames(allGames);
    }

    // Game info
    async function showGameInfo(gameId) {
      currentGameId = gameId;
      const game = allGames.find(g => g.id === gameId);
      if (!game) return;

      document.getElementById('gameInfoImage').src = game.thumbnail;
      document.getElementById('gameInfoTitle').textContent = game.title;
      document.getElementById('gameInfoStars').innerHTML = renderStars(game.averageRating || 0);
      document.getElementById('gameInfoRating').textContent = (game.averageRating || 0).toFixed(1);
      document.getElementById('gameInfoReviewCount').textContent = `${game.totalReviews || 0} yorum`;
      document.getElementById('gameInfoDescription').textContent = game.description;
      document.getElementById('gameInfoCategory').textContent = game.category;

      document.getElementById('playFromInfo').onclick = async () => {
        if (db && currentUser) {
          await updateDoc(doc(db, 'games', gameId), { playCount: increment(1) });
        }
        gameFrame.src = game.url;
        gameInfoModal.hide();
        gameModal.show();
      };

      // Review form: giri≈ü yoksa gizle
      const reviewForm = document.getElementById('reviewForm');
      reviewForm.style.display = currentUser ? 'block' : 'none';

      loadReviews(gameId);
      gameInfoModal.show();
    }

    // Reviews (okuma herkes, yazma sadece giri≈üli)
    async function loadReviews(gameId) {
      if (!db) return;

      const reviewsRef = collection(db, 'games', gameId, 'reviews');
      const q = query(reviewsRef, orderBy('timestamp', 'desc'));

      onSnapshot(q, (snapshot) => {
        const reviewsList = document.getElementById('reviewsList');
        reviewsList.innerHTML = '';

        if (snapshot.empty) {
          reviewsList.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-comments"></i>
              <p>Hen√ºz yorum yok. ƒ∞lk yorumu siz yapƒ±n!</p>
            </div>
          `;
          return;
        }

        snapshot.forEach((d) => {
          const review = d.data();
          const reviewItem = createReviewElement(d.id, review);
          reviewsList.appendChild(reviewItem);
        });
      });
    }

    function createReviewElement(reviewId, review) {
      const div = document.createElement('div');
      div.className = 'review-item';

      const isOwner = currentUser && review.userId === currentUser.id;
      const isLiked = review.likedBy?.includes(currentUser?.id);

      div.innerHTML = `
        <div class="review-header">
          <div class="review-avatar">${(review.userName?.[0] || 'U').toUpperCase()}</div>
          <div class="review-user-info">
            <div class="review-user-name">${review.userName || 'Kullanƒ±cƒ±'}</div>
            <div class="review-date">${formatDate(review.timestamp)}</div>
          </div>
          <div class="review-rating">${renderStars(review.rating || 0)}</div>
        </div>
        <div class="review-text">${review.comment || ''}</div>
        <div class="review-actions">
          <button class="review-action-btn ${isLiked ? 'liked' : ''}" data-action="like" data-review-id="${reviewId}">
            <i class="fas fa-thumbs-up"></i>
            <span>${review.likes || 0}</span>
          </button>
          ${isOwner ? `
            <button class="review-action-btn delete" data-action="delete" data-review-id="${reviewId}">
              <i class="fas fa-trash"></i>
              Sil
            </button>
          ` : ''}
        </div>
      `;

      div.querySelectorAll('.review-action-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const action = btn.getAttribute('data-action');
          const rid = btn.getAttribute('data-review-id');

          if (!currentUser) {
            const u = await ensureLogin();
            if (!u) return;
          }

          if (action === 'like') {
            await toggleLike(rid);
          } else if (action === 'delete') {
            if (confirm('Bu yorumu silmek istediƒüinize emin misiniz?')) {
              await deleteReview(rid);
            }
          }
        });
      });

      return div;
    }

    function formatDate(timestamp) {
      if (!timestamp) return '';
      const date = timestamp.toDate();
      const now = new Date();
      const diff = now - date;

      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);

      if (minutes < 60) return `${minutes} dakika √∂nce`;
      if (hours < 24) return `${hours} saat √∂nce`;
      if (days < 7) return `${days} g√ºn √∂nce`;

      return date.toLocaleDateString('tr-TR');
    }

    // Star rating UI
    document.querySelectorAll('.star').forEach(star => {
      star.addEventListener('click', () => {
        selectedRating = parseInt(star.getAttribute('data-rating'));
        updateStarDisplay();
      });

      star.addEventListener('mouseenter', () => {
        const rating = parseInt(star.getAttribute('data-rating'));
        highlightStars(rating);
      });
    });

    document.getElementById('starRating').addEventListener('mouseleave', () => {
      updateStarDisplay();
    });

    function highlightStars(rating) {
      document.querySelectorAll('.star').forEach((s, i) => {
        if (i < rating) s.classList.add('active');
        else s.classList.remove('active');
      });
    }

    function updateStarDisplay() {
      highlightStars(selectedRating);
    }

    // Submit review (giri≈ü yoksa popup a√ß)
    document.getElementById('submitReview').addEventListener('click', async () => {
      if (!db) {
        alert('Firebase yapƒ±landƒ±rmasƒ± gerekli!');
        return;
      }

      if (!currentUser) {
        const u = await ensureLogin();
        if (!u) return;
      }

      if (selectedRating === 0) {
        alert('L√ºtfen puan verin!');
        return;
      }

      const comment = document.getElementById('reviewText').value.trim();
      if (!comment) {
        alert('L√ºtfen yorum yazƒ±n!');
        return;
      }

      try {
        const existingReview = await getDocs(
          query(
            collection(db, 'games', currentGameId, 'reviews'),
            where('userId', '==', currentUser.id)
          )
        );

        if (!existingReview.empty) {
          alert('Bu oyun i√ßin zaten yorum yaptƒ±nƒ±z!');
          return;
        }

        await addDoc(collection(db, 'games', currentGameId, 'reviews'), {
          userId: currentUser.id,
          userName: currentUser.name,
          rating: selectedRating,
          comment: comment,
          timestamp: serverTimestamp(),
          likes: 0,
          likedBy: []
        });

        await updateGameRating(currentGameId);

        selectedRating = 0;
        document.getElementById('reviewText').value = '';
        updateStarDisplay();

        alert('Yorumunuz ba≈üarƒ±yla g√∂nderildi!');
      } catch (error) {
        console.error('Yorum g√∂nderme hatasƒ±:', error);
        alert('Yorum g√∂nderilemedi!');
      }
    });

    async function updateGameRating(gameId) {
      if (!db) return;

      const reviewsRef = collection(db, 'games', gameId, 'reviews');
      const snapshot = await getDocs(reviewsRef);

      let totalRating = 0;
      let count = 0;

      snapshot.forEach((d) => {
        totalRating += d.data().rating;
        count++;
      });

      const averageRating = count > 0 ? totalRating / count : 0;

      await updateDoc(doc(db, 'games', gameId), {
        averageRating: averageRating,
        totalReviews: count
      });
    }

    async function toggleLike(reviewId) {
      if (!currentUser || !db) return;

      const reviewRef = doc(db, 'games', currentGameId, 'reviews', reviewId);
      const reviewDoc = await getDoc(reviewRef);
      if (!reviewDoc.exists()) return;

      const review = reviewDoc.data();
      const likedBy = review.likedBy || [];
      const isLiked = likedBy.includes(currentUser.id);

      if (isLiked) {
        await updateDoc(reviewRef, {
          likes: increment(-1),
          likedBy: likedBy.filter(id => id !== currentUser.id)
        });
      } else {
        await updateDoc(reviewRef, {
          likes: increment(1),
          likedBy: [...likedBy, currentUser.id]
        });
      }
    }

    async function deleteReview(reviewId) {
      if (!db) return;

      try {
        await deleteDoc(doc(db, 'games', currentGameId, 'reviews', reviewId));
        await updateGameRating(currentGameId);
      } catch (error) {
        console.error('Yorum silme hatasƒ±:', error);
        alert('Yorum silinemedi!');
      }
    }

    // Search
    searchInput.addEventListener('input', (e) => {
      const q = e.target.value.toLowerCase();
      const filtered = allGames.filter(game =>
        (game.title || '').toLowerCase().includes(q) ||
        (game.description || '').toLowerCase().includes(q) ||
        (game.category || '').toLowerCase().includes(q)
      );
      renderGames(filtered);
    });

    // Filters
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const filter = btn.getAttribute('data-filter');

        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        if (filter === 'all') renderGames(allGames);
        else renderGames(allGames.filter(game => game.category === filter));
      });
    });

    // Sidebar categories
    document.querySelectorAll('[data-category]').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const category = link.getAttribute('data-category');

        document.querySelectorAll('[data-category]').forEach(l => l.classList.remove('active'));
        link.classList.add('active');

        if (category === 'all') renderGames(allGames);
        else renderGames(allGames.filter(game => game.category === category));
      });
    });

    // Sort
    document.getElementById('sortSelect').addEventListener('change', (e) => {
      const sortBy = e.target.value;
      let sorted = [...allGames];

      if (sortBy === 'rating') {
        sorted.sort((a, b) => (b.averageRating || 0) - (a.averageRating || 0));
      } else if (sortBy === 'popular') {
        sorted.sort((a, b) => (b.playCount || 0) - (a.playCount || 0));
      } else if (sortBy === 'newest') {
        sorted.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
      }

      renderGames(sorted);
    });

    // Favorites
    document.getElementById('favoritesLink').addEventListener('click', (e) => {
      e.preventDefault();
      const favGames = allGames.filter(game => favorites.includes(game.id));
      renderGames(favGames);
    });

    // Tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = btn.getAttribute('data-tab');

        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
        document.getElementById(tab + 'Tab').classList.add('active');
      });
    });

    // Stats
    function updateStats() {
      document.getElementById('totalGames').textContent = allGames.length;

      let totalReviews = 0;
      allGames.forEach(game => totalReviews += game.totalReviews || 0);
      document.getElementById('totalReviews').textContent = totalReviews;
    }

    // Modal close
    document.getElementById('floatingCloseBtn').addEventListener('click', () => {
      gameModal.hide();
    });

    document.getElementById('gameModal').addEventListener('hidden.bs.modal', () => {
      gameFrame.src = '';
    });
  </script>
</body>
</html>
